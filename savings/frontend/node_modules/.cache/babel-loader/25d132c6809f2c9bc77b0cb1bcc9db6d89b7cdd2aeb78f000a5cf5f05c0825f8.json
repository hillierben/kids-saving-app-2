{"ast":null,"code":"import _regeneratorRuntime from\"/Users/benhillier/Documents/GitHub/kids-saving-app/savings/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/benhillier/Documents/GitHub/kids-saving-app/savings/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _defineProperty from\"/Users/benhillier/Documents/GitHub/kids-saving-app/savings/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/Users/benhillier/Documents/GitHub/kids-saving-app/savings/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/benhillier/Documents/GitHub/kids-saving-app/savings/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from'react';import csrftoken from'./CSRFToken';import{useNavigate}from'react-router-dom';import{useContext}from'react';import TokenContext from'../contexts/Token';import jwt_decode from\"jwt-decode\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Login=function Login(props){var _React$useState=React.useState({email:\"\",password:\"\"}),_React$useState2=_slicedToArray(_React$useState,2),formData=_React$useState2[0],setFormData=_React$useState2[1];var navigate=useNavigate();var _useContext=useContext(TokenContext),setToken=_useContext.setToken,setUser=_useContext.setUser;// Update registerData whenever form data changes\nfunction handleChange(event){var _event$target=event.target,name=_event$target.name,value=_event$target.value;setFormData(function(prevFormData){return _objectSpread(_objectSpread({},prevFormData),{},_defineProperty({},name,value));});}// Login user\nvar loginUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return fetch('http://127.0.0.1:8000/api/token/',{method:'POST',headers:{\"Content-type\":\"application/json; charset=UTF-8\"// // 'X-CSRFToken': csrftoken,\n},body:JSON.stringify({username:formData.email,password:formData.password})});case 2:response=_context.sent;_context.next=5;return response.json();case 5:data=_context.sent;if(response.status===200){setToken(data);// decode token to obtain user details\nsetUser(jwt_decode(data.access).name);localStorage.setItem(\"userName\",jwt_decode(data.access).name);localStorage.setItem(\"userEmail\",jwt_decode(data.access).email);navigate(\"/portal\");}else{alert(\"Invalid Login\");navigate(\"/login\");}case 7:case\"end\":return _context.stop();}},_callee);}));return function loginUser(){return _ref.apply(this,arguments);};}();function handleSubmit(event){event.preventDefault();setToken(csrftoken);setFormData({email:\"\",password:\"\"});loginUser();}return/*#__PURE__*/_jsx(\"div\",{className:\"main-page\",children:/*#__PURE__*/_jsx(\"form\",{className:\"login-form\",onSubmit:handleSubmit,children:/*#__PURE__*/_jsxs(\"div\",{className:\"login-div\",children:[/*#__PURE__*/_jsx(\"p\",{children:props.loggedOut}),/*#__PURE__*/_jsx(\"h2\",{children:\"Login\"}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Email\",className:\"rf-input rf-parent-name\",type:\"text\",id:\"email\",name:\"email\",value:formData.email,onChange:handleChange,required:true}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Password\",className:\"rf-input rf-parent-name\",type:\"password\",id:\"password\",name:\"password\",value:formData.password,onChange:handleChange,required:true}),/*#__PURE__*/_jsx(\"button\",{className:\"rf-submit\",children:\"Login\"})]})})});};export default Login;","map":{"version":3,"names":["React","csrftoken","useNavigate","useContext","TokenContext","jwt_decode","jsx","_jsx","jsxs","_jsxs","Login","props","_React$useState","useState","email","password","_React$useState2","_slicedToArray","formData","setFormData","navigate","_useContext","setToken","setUser","handleChange","event","_event$target","target","name","value","prevFormData","_objectSpread","_defineProperty","loginUser","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","data","wrap","_callee$","_context","prev","next","fetch","method","headers","body","JSON","stringify","username","sent","json","status","access","localStorage","setItem","alert","stop","apply","arguments","handleSubmit","preventDefault","className","children","onSubmit","loggedOut","placeholder","type","id","onChange","required"],"sources":["/Users/benhillier/Documents/GitHub/kids-saving-app/savings/frontend/src/components/Login.js"],"sourcesContent":["import React from 'react'\nimport csrftoken from './CSRFToken';\nimport { useNavigate } from 'react-router-dom';\nimport { useContext } from 'react';\nimport TokenContext from '../contexts/Token';\nimport jwt_decode from \"jwt-decode\";\n\nconst Login = (props) => {\n  const[formData, setFormData] = React.useState({\n    email: \"\",\n    password: \"\",\n  })\n  const navigate = useNavigate();\n  const{setToken, setUser} = useContext(TokenContext);\n\n  // Update registerData whenever form data changes\n  function handleChange(event) {\n    const {name, value} = event.target;\n    setFormData((prevFormData) => ({\n      ...prevFormData,\n      [name]: value,\n    }))\n  }\n\n  // Login user\n  let loginUser = async() => {\n    let response = await fetch('http://127.0.0.1:8000/api/token/', {\n      method: 'POST',\n      headers: {\n        \"Content-type\": \"application/json; charset=UTF-8\",\n        // // 'X-CSRFToken': csrftoken,\n      },\n      body: JSON.stringify({\n        username: formData.email,\n        password: formData.password\n        \n      })\n    })\n    let data = await response.json()\n    if(response.status === 200) {\n      setToken(data)\n      // decode token to obtain user details\n      setUser(jwt_decode(data.access).name);\n      localStorage.setItem(\"userName\", jwt_decode(data.access).name)\n      localStorage.setItem(\"userEmail\", jwt_decode(data.access).email)\n      navigate(\"/portal\");\n    } else {\n      alert(\"Invalid Login\")\n      navigate(\"/login\");\n    }\n    }\n\n  function handleSubmit(event) {\n    event.preventDefault();\n    setToken(csrftoken)\n    setFormData({\n      email: \"\",\n      password: \"\",\n    })\n    loginUser()\n    }\n\n  return (\n    <div className=\"main-page\">\n    <form className=\"login-form\" onSubmit={handleSubmit}>\n      <div className=\"login-div\">\n          <p>{props.loggedOut}</p>\n          <h2>Login</h2>\n          <input\n            placeholder=\"Email\"\n            className=\"rf-input rf-parent-name\"\n            type=\"text\"\n            id=\"email\"\n            name=\"email\"\n            value={formData.email}\n            onChange={handleChange}\n            required/>\n          <input\n            placeholder=\"Password\"\n            className=\"rf-input rf-parent-name\"\n            type=\"password\"\n            id=\"password\"\n            name=\"password\"\n            value={formData.password}\n            onChange={handleChange}\n            required/>\n          <button className='rf-submit'>Login</button>\n      </div>\n    </form>\n    </div>\n  )\n}\n\nexport default Login\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}